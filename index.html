<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘• ì½”ë”” ì¶”ì²œ AI</title>
    <style>
        /* ==========================================================
           CSS CODE START (ìŠ¤íƒ€ì¼)
           ========================================================== */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #4a4a8a;
            margin-bottom: 30px;
        }

        /* --- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ --- */
        #upload-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            margin-bottom: 30px;
            background-color: #fcfcfc;
        }
        #file-input {
            display: none;
        }
        #file-label {
            background-color: #5c67f2;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s;
            margin-bottom: 15px;
        }
        #file-label:hover {
            background-color: #4a54e1;
        }
        #preview-img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-top: 15px;
            display: none;
        }

        /* --- ê²°ê³¼ ì„¹ì…˜ --- */
        #loading {
            text-align: center;
            font-size: 1.2em;
            color: #5c67f2;
            margin-top: 20px;
            display: none;
        }
        #results-section {
            margin-top: 40px;
            border-top: 2px solid #eee;
            padding-top: 30px;
        }

        /* --- ì˜ˆì¸¡ ì†ì„± ë°•ìŠ¤ --- */
        #query-attributes {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-bottom: 30px;
            padding: 15px;
            background-color: #e8eaf6;
            border-radius: 8px;
        }
        .attr-box {
            padding: 10px 20px;
            border-radius: 6px;
            background-color: white;
            margin: 10px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            min-width: 150px;
        }
        .attr-box h3 {
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 1.2em;
            color: #3f51b5;
        }
        .attr-box p {
            margin: 0;
            font-weight: bold;
            font-size: 1.1em;
        }
        .confidence {
            font-size: 0.8em;
            color: #9e9e9e;
            margin-top: 3px;
        }
        .warning-text {
            color: #ff5722;
            font-weight: bold;
            margin-top: 15px;
            text-align: center;
        }

        /* --- ì¶”ì²œ ëª©ë¡ --- */
        #recommendation-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .recommendation-card {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 280px;
            transition: transform 0.3s;
        }
        .recommendation-card:hover {
            transform: translateY(-5px);
        }
        .rec-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }
        .rec-info {
            padding: 15px;
        }
        .rec-info h3 {
            margin-top: 0;
            color: #3f51b5;
            font-size: 1.1em;
        }
        /* ì ìˆ˜ ë§‰ëŒ€ */
        .score-bar {
            background-color: #eee;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        .score-fill {
            height: 10px;
            background-color: #4CAF50; /* Green for score */
        }
        .rec-details {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        /* ìƒ‰ìƒ ìŠ¤ì™€ì¹˜ */
        .color-swatch {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 5px;
            border: 1px solid #ccc;
            vertical-align: middle;
        }
        /* ==========================================================
           CSS CODE END
           ========================================================== */
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ‘• AI ì½”ë”” ì¶”ì²œ ì„œë¹„ìŠ¤</h1>
        
        <div id="upload-section">
            <input type="file" id="file-input" accept="image/*">
            <label for="file-input" id="file-label">ğŸ‘” ì˜· ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
            <p id="file-name-display"></p>
            <img id="preview-img" src="#" alt="ì—…ë¡œë“œ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
            <button onclick="recommendOutfit()" id="recommend-button" style="display:none; margin-top: 20px; padding: 10px 30px; background-color: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">âœ¨ ì½”ë”” ì¶”ì²œ ì‹œì‘</button>
        </div>

        <div id="loading">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”... AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.</div>

        <div id="results-section" style="display:none;">
            <h2>ğŸ’¡ AI ë¶„ì„ ê²°ê³¼</h2>
            <div id="query-attributes">
                </div>

            <p id="guidance-message" class="warning-text"></p>

            <hr>

            <h2>âœ¨ ì¶”ì²œ ì½”ë”” ëª©ë¡</h2>
            <div id="recommendation-list">
                </div>
        </div>

        <div id="error-message" class="warning-text" style="display:none; color: red;"></div>
    </div>

    <script>
        /* ==========================================================
           JAVASCRIPT CODE START (ë¡œì§ ë° API í†µì‹ )
           ========================================================== */
        
        // ë°±ì—”ë“œ ì„œë²„ ì£¼ì†Œ ì„¤ì • (app.pyì˜ host='0.0.0.0', port=5000 ê¸°ì¤€)
        const API_BASE_URL = 'http://localhost:5000';
        
        const fileInput = document.getElementById('file-input');
        const previewImg = document.getElementById('preview-img');
        const fileNameDisplay = document.getElementById('file-name-display');
        const recommendButton = document.getElementById('recommend-button');

        // ìƒ‰ìƒ ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” HEX ì½”ë“œë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ (ìƒ‰ìƒ ìŠ¤ì™€ì¹˜ìš©)
        function getColorHex(colorName) {
            const colors = {
                'Black': '#000000', 'White': '#F5F5F5', 'Red': '#E53935', 'Blue': '#1E88E5',
                'Green': '#4CAF50', 'Light Gray': '#BDBDBD', 'Dark Gray': '#616161', 
                'Beige': '#F5F5DC', 'Brown': '#795548', 'Yellow': '#FFEB3B', 
                'Pink': '#F48FB1', 'Orange': '#FF9800', 'Purple': '#9C27B0',
                'Mint': '#4DB6AC', 'Navy': '#1A237E', 'Sky Blue': '#81D4FA',
                'Khaki': '#BDB76B'
            };
            return colors[colorName] || '#CCCCCC'; // ë§µì— ì—†ëŠ” ìƒ‰ìƒì€ ê¸°ë³¸ íšŒìƒ‰
        }
        
        // íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° ë° ë²„íŠ¼ í™œì„±í™”
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    previewImg.style.display = 'block';
                    fileNameDisplay.textContent = `ì„ íƒëœ íŒŒì¼: ${file.name}`;
                    recommendButton.style.display = 'block';
                    // ì´ì „ ê²°ê³¼ ì´ˆê¸°í™”
                    document.getElementById('results-section').style.display = 'none';
                    document.getElementById('error-message').style.display = 'none';
                };
                reader.readAsDataURL(file);
            } else {
                previewImg.style.display = 'none';
                previewImg.src = '#';
                fileNameDisplay.textContent = '';
                recommendButton.style.display = 'none';
            }
        });

        // ì¶”ì²œ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰
        async function recommendOutfit() {
            const file = fileInput.files[0];
            if (!file) {
                alert('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // UI ìƒíƒœ ë³€ê²½
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            recommendButton.disabled = true;

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_BASE_URL}/recommend`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    displayResults(data);
                } else {
                    displayError(data.message || `API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
                }

            } catch (error) {
                console.error('Fetch error:', error);
                displayError('ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ê±°ë‚˜ ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.)');
            } finally {
                // UI ìƒíƒœ ë³µêµ¬
                document.getElementById('loading').style.display = 'none';
                recommendButton.disabled = false;
            }
        }
        
        // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        function displayResults(data) {
            const resultsSection = document.getElementById('results-section');
            const attrContainer = document.getElementById('query-attributes');
            const recList = document.getElementById('recommendation-list');
            const guidanceMessage = document.getElementById('guidance-message');

            attrContainer.innerHTML = '';
            recList.innerHTML = '';
            
            // 1. AI ë¶„ì„ ê²°ê³¼ í‘œì‹œ (ì‚¬ìš©ìê°€ ì˜¬ë¦° ì˜·ì˜ ì†ì„±)
            const attrs = data.query_attributes;
            const confidence = data.confidence;
            
            let minConfidence = 1.0; 
            
            // ì¹´í…Œê³ ë¦¬, ìƒ‰ìƒ, ìŠ¤íƒ€ì¼, ê³„ì ˆ ìˆœì„œë¡œ í‘œì‹œ
            ['category', 'color', 'style', 'season'].forEach(key => {
                const confValue = confidence[key];
                
                // ê³„ì ˆì€ ì„œë²„ì—ì„œ 1.0ìœ¼ë¡œ ì²˜ë¦¬í–ˆê±°ë‚˜, nanì¼ ê²½ìš° 1.0ìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ ìµœì†Œê°’ ê³„ì‚°ì— ì°¸ì—¬
                const actualConfidence = isNaN(confValue) ? 1.0 : confValue; 
                
                if (actualConfidence < minConfidence) {
                    minConfidence = actualConfidence;
                }

                const box = document.createElement('div');
                box.className = 'attr-box';
                // ê°œë³„ ì •í™•ë„ ì œê±° 
                box.innerHTML = `
                    <h3>${getAttrLabel(key)}</h3>
                    <p>${attrs[key]}</p>
                `;
                attrContainer.appendChild(box);
            });

            // ì¢…í•© ë¶„ì„ ì •í™•ë„ ë°•ìŠ¤ ì¶”ê°€ 
            const overallBox = document.createElement('div');
            overallBox.className = 'attr-box';
            overallBox.style.backgroundColor = '#fff8e1'; /* ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½ */
            overallBox.style.border = '2px solid #ffb300';
            overallBox.innerHTML = `
                <h3>ì¢…í•© ë¶„ì„ ì •í™•ë„</h3>
                <p style="color: #ffb300;">${(minConfidence * 100).toFixed(1)}%</p>
                <div class="confidence">(ìµœì € ì†ì„± ì‹ ë¢°ë„ ê¸°ì¤€)</div>
            `;
            attrContainer.appendChild(overallBox);

            // 2. ê°€ì´ë“œ ë©”ì‹œì§€ í‘œì‹œ
            guidanceMessage.textContent = data.guidance || '';

            // 3. ì¶”ì²œ ì½”ë”” ëª©ë¡ í‘œì‹œ
            data.recommendations.forEach(rec => {
                const card = document.createElement('div');
                card.className = 'recommendation-card';

                const imageUrl = `${API_BASE_URL}/image/${rec.filename}`;
                const colorHex = getColorHex(rec.color); // ì¶”ì²œ ì•„ì´í…œì˜ ìƒ‰ìƒ HEX ì½”ë“œ

                const maxPossibleScore = 1.15; 
                const scorePercent = (rec.total_score / maxPossibleScore) * 100;

                // ë°±ì—”ë“œì—ì„œ ì „ë‹¬ëœ seasonê³¼ styleì„ ì‚¬ìš©
                const recommendedCategory = rec.category || 'ì •ë³´ ì—†ìŒ'; 
                const recommendedStyle = rec.style || 'ì •ë³´ ì—†ìŒ'; 
                const recommendedSeason = rec.season || 'ì •ë³´ ì—†ìŒ'; 
                const recommendedColor = rec.color || 'ì •ë³´ ì—†ìŒ';

                card.innerHTML = `
                    <img src="${imageUrl}" alt="${rec.filename}" class="rec-image" onerror="this.onerror=null;this.src='https://via.placeholder.com/280x280.png?text=Image+Not+Found';" loading="lazy">
                    <div class="rec-info">
                        <h3>â­ ì¶”ì²œ ì ìˆ˜: ${rec.total_score.toFixed(3)}</h3>
                        <div class="score-bar"><div class="score-fill" style="width: ${scorePercent.toFixed(0)}%"></div></div>
                        <p style="font-size: 0.9em; margin-top: 5px;">
                            ì¹´í…Œê³ ë¦¬: <strong>${recommendedCategory}</strong><br>
                            ìŠ¤íƒ€ì¼: <strong>${recommendedStyle}</strong><br>
                            ê³„ì ˆ: <strong>${recommendedSeason}</strong><br>
                            ìƒ‰ìƒ: 
                            <span class="color-swatch" style="background-color: ${colorHex};"></span>
                            <strong>${recommendedColor}</strong> 
                        </p>
                        <div class="rec-details">
                            <p>ìƒ‰ìƒ ì¡°í•©: ${(rec.details.color_score * 100).toFixed(0)}ì </p>
                            <p>ìŠ¤íƒ€ì¼ ì¼ì¹˜: ${(rec.details.style_score * 100).toFixed(0)}ì </p>
                            <p>ì‹œê°ì  ìœ ì‚¬ë„: ${(rec.details.sim_score * 100).toFixed(0)}ì </p>
                            <p>ê³„ì ˆ ì¼ì¹˜: ${(rec.details.season_score * 100).toFixed(0)}ì </p> 
                        </div>
                    </div>
                `;
                recList.appendChild(card);
            });

            resultsSection.style.display = 'block';
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function displayError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = `ğŸš¨ ì˜¤ë¥˜ ë°œìƒ: ${message}`;
            errorElement.style.display = 'block';
        }

        // ì†ì„± í‚¤ë¥¼ í•œê¸€ ë¼ë²¨ë¡œ ë³€í™˜
        function getAttrLabel(key) {
            switch (key) {
                case 'category': return 'ì¹´í…Œê³ ë¦¬';
                case 'color': return 'ì£¼ìš” ìƒ‰ìƒ';
                case 'style': return 'ìŠ¤íƒ€ì¼';
                case 'season': return 'ê³„ì ˆ';
                default: return key;
            }
        }
        /* ==========================================================
           JAVASCRIPT CODE END
           ========================================================== */
    </script>

</body>
</html>